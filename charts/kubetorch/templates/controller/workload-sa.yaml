# low-privilege runtime SA for user pods - not as privileged as the controller SA
{{- $allNamespaces := .Values.kubetorchConfig.deployment_namespaces | default list }}
{{- if not (has .Release.Namespace $allNamespaces) }}
  {{- $allNamespaces = append $allNamespaces .Release.Namespace }}
{{- end }}
{{- range $allNamespaces }}
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: kubetorch-service-account
  namespace: {{ . }}
{{- if $.Values.kubetorchConfig.serviceAccountAnnotations }}
  annotations:
{{- if kindIs "map" $.Values.kubetorchConfig.serviceAccountAnnotations }}
{{ $.Values.kubetorchConfig.serviceAccountAnnotations | toYaml | nindent 4 }}
{{- end }}
{{- end }}
{{- end }}
