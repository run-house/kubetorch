name: Nightly GPU Tests

on:
  workflow_dispatch:
  schedule:
    # Run every night at 2 AM UTC
    - cron: '0 2 * * *'

jobs:
  gpu-tests:
    uses: ./.github/workflows/test-job.yaml
    with:
      test_name: gpu
      test_suffix: -gpu
      pytest_command: "pytest -v --durations=25 --level minimal -m 'gpu_test'"
    secrets: inherit

  cleanup:
    if: ${{ always() }}
    needs: [gpu-tests]
    uses: ./.github/workflows/cleanup.yaml
    with:
      test_suffixes: "-gpu"
    secrets: inherit
